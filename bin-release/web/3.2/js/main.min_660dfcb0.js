function randInt(){return globalRandom["int"]()}function rand01(){return globalRandom.f01()}function randF(t,e){return globalRandom.f(t,e)}function randI(t,e){return globalRandom.i(t,e)}function randBool(t){return void 0===t&&(t=.5),globalRandom.bool(t)}var __reflect=this&&this.__reflect||function(t,e,i){t.__class__=e,i?i.push(e):i=[e],t.__types__=t.__types__?i.concat(t.__types__):i},__extends=this&&this.__extends||function(t,e){function i(){this.constructor=t}for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);i.prototype=e.prototype,t.prototype=new i},__awaiter=this&&this.__awaiter||function(t,e,i,n){return new(i||(i=Promise))(function(r,o){function a(t){try{l(n.next(t))}catch(e){o(e)}}function s(t){try{l(n["throw"](t))}catch(e){o(e)}}function l(t){t.done?r(t.value):new i(function(e){e(t.value)}).then(a,s)}l((n=n.apply(t,e||[])).next())})},__generator=this&&this.__generator||function(t,e){function i(t){return function(e){return n([t,e])}}function n(i){if(r)throw new TypeError("Generator is already executing.");for(;l;)try{if(r=1,o&&(a=o[2&i[0]?"return":i[0]?"throw":"next"])&&!(a=a.call(o,i[1])).done)return a;switch(o=0,a&&(i=[0,a.value]),i[0]){case 0:case 1:a=i;break;case 4:return l.label++,{value:i[1],done:!1};case 5:l.label++,o=i[1],i=[0];continue;case 7:i=l.ops.pop(),l.trys.pop();continue;default:if(a=l.trys,!(a=a.length>0&&a[a.length-1])&&(6===i[0]||2===i[0])){l=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){l.label=i[1];break}if(6===i[0]&&l.label<a[1]){l.label=a[1],a=i;break}if(a&&l.label<a[2]){l.label=a[2],l.ops.push(i);break}a[2]&&l.ops.pop(),l.trys.pop();continue}i=e.call(t,l)}catch(n){i=[6,n],o=0}finally{r=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}var r,o,a,s,l={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return s={next:i(0),"throw":i(1),"return":i(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s},__assign=this&&this.__assign||Object.assign||function(t){for(var e,i=1,n=arguments.length;n>i;i++){e=arguments[i];for(var r in e)Object.prototype.hasOwnProperty.call(e,r)&&(t[r]=e[r])}return t},GameObject=function(){function t(){this.display=null,t.objects.push(this)}return Object.defineProperty(t.prototype,"X",{get:function(){return this.display.x},set:function(t){this.display.x=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"Y",{get:function(){return this.display.y},set:function(t){this.display.y=t},enumerable:!0,configurable:!0}),t.prototype.destroy=function(){this.deleteFlag=!0},t.prototype.onDestroy=function(){},t.initial=function(e){t.baseDisplay=e,t.gameDisplay=new egret.DisplayObjectContainer,t.baseDisplay.addChild(t.gameDisplay)},t.process=function(){t.objects.forEach(function(t){return t.update()}),t.objects=t.objects.filter(function(t){return t.deleteFlag&&t._delete(),!t.deleteFlag}),t.transit&&(t.dispose(),t.transit(),t.transit=null)},t.dispose=function(){t.objects=t.objects.filter(function(t){return t.destroy(),t._delete(),!1})},t.prototype._delete=function(){this.onDestroy(),this.display&&(this.display.parent.removeChild(this.display),this.display=null)},t.objects=[],t}();__reflect(GameObject.prototype,"GameObject");var TilePerW=.2,TilePerH=.18,TileColor=0,Tile=function(t){function e(i,n){var r=t.call(this)||this;return e.tiles.push(r),r.sizeW=Util.w(TilePerW),r.sizeH=Util.h(TilePerH),r.setShape(i,n),r}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.tiles=e.tiles.filter(function(e){return e!=t})},e.prototype.setShape=function(t,e){this.display=new egret.Shape,GameObject.gameDisplay.addChild(this.display);var i=this.display;i.x=t,i.y=e,i.graphics.beginFill(TileColor),i.graphics.drawRect(-.5*this.sizeW,-.45*this.sizeH,this.sizeW,.9*this.sizeH),i.graphics.endFill()},e.prototype.update=function(){if(!GameOver.I){if(this.checkTouch())return void this.defeated();this.Y+=Game.I.speed,this.checkFall()&&new GameOver}},e.prototype.checkTouch=function(){return Game.I.press&&Math.pow(Game.I.tapX-this.X,2)<Math.pow(.6*this.sizeW,2)&&Math.pow(Game.I.tapY-this.Y,2)<Math.pow(.6*this.sizeH,2)?!0:void 0},e.prototype.checkFall=function(){return this.Y>Util.height},e.prototype.defeated=function(){this.destroy(),SoundEffect.I.play(),Score.I.addPoint(10);for(var t=0;15>t;t++)new Debris(this.X,this.Y)},e.tiles=[],e}(GameObject);__reflect(Tile.prototype,"Tile");var DefaultBestScore=50,BACK_COLOR=16317180,FONT_COLOR=3158064,FONT2_COLOR=13631488,GameSpeedLowPH=1/120,GameSpeedTopPH=1/45,Game=function(t){function e(){var i=t.call(this)||this;return i.counter=0,i.length=0,i.next=0,i.localTouchBegan=!1,i.press=!1,i.touch=!1,i.tapX=0,i.tapY=0,e.I=i,i.speedMax=i.speed=Util.h(GameSpeedLowPH),GameObject.gameDisplay.stage.addEventListener(egret.TouchEvent.TOUCH_BEGIN,function(t){return i.touchBegin(t)},i),GameObject.gameDisplay.stage.addEventListener(egret.TouchEvent.TOUCH_MOVE,function(t){return i.touchMove(t)},i),GameObject.gameDisplay.stage.addEventListener(egret.TouchEvent.TOUCH_END,function(t){return i.touchEnd(t)},i),i}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;e.I=null,GameObject.gameDisplay.stage.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,function(e){return t.touchBegin(e)},this),GameObject.gameDisplay.stage.removeEventListener(egret.TouchEvent.TOUCH_MOVE,function(e){return t.touchMove(e)},this),GameObject.gameDisplay.stage.removeEventListener(egret.TouchEvent.TOUCH_END,function(e){return t.touchEnd(e)},this)},e.prototype.touchBegin=function(t){this.localTouchBegan=this.press=this.touch=!0,this.tapX=t.localX,this.tapY=t.localY},e.prototype.touchMove=function(t){this.tapX=t.localX,this.tapY=t.localY},e.prototype.touchEnd=function(t){this.touch=!1},e.prototype.touchUpdate=function(){this.localTouchBegan?this.localTouchBegan=!1:this.press=!1},e.prototype.update=function(){if(null==GameOver.I){this.counter++,this.touchUpdate();var t=Util.clamp01(this.counter/7200),e=Util.h(Util.lerp(GameSpeedLowPH,GameSpeedTopPH,t));if(this.length+=this.speed,this.speed+=Util.clamp(e-this.speed,-e/20,e/20),this.next<=this.length){var i=Util.w(TilePerW),n=randI(0,4),r=Util.w(.5)+(n-1.5)*i,o=-.5*Util.h(TilePerH);randBool(.8)?(new Tile(r,o),this.next+=randI(1,5)*Util.h(TilePerH)):randBool(.7)?(new TileLong(r,o),this.next+=TileLongLength*Util.h(TilePerH)):(new TileBig(r,o-.5*Util.h(TilePerH)),this.next+=randI(2,6)*Util.h(TilePerH))}}},e}(GameObject);__reflect(Game.prototype,"Game");var ScenePlay=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return __extends(e,t),e.loadScene=function(){new SoundEffect,new Game,new Score},e.prototype.update=function(){},e}(GameObject);__reflect(ScenePlay.prototype,"ScenePlay");var SceneTitle=function(t){function e(){var e=t.call(this)||this;e.texts=[],e.startButton=null,e.settingsButton=null,e.texts[0]=Util.newTextField("黒いのを打て",Util.width/9,FONT_COLOR,.5,.25,!0,!0),e.texts[1]=Util.newTextField("流れてくる黒タイルをタップ！",Util.width/20,FONT_COLOR,.5,.35,!0,!1);var i=Score.bestScore;return e.texts[2]=Util.newTextField("BEST"+i,Util.width/14,FONT_COLOR,.5,.45,!0,!0),e.startButton=new Button("スタート",Util.width/16,BACK_COLOR,.5,.7,.7,.12,FONT_COLOR,1,!0,e.onTapStart),e.texts.forEach(function(t){t&&GameObject.baseDisplay.addChild(t)}),e}return __extends(e,t),e.loadScene=function(){new SoundEffect,new e},e.prototype.onDestroy=function(){this.texts.forEach(function(t){t&&t.parent.removeChild(t)}),this.texts=null},e.prototype.update=function(){},e.prototype.onTapStart=function(){GameObject.transit=ScenePlay.loadScene,SoundEffect.I.play()},e}(GameObject);__reflect(SceneTitle.prototype,"SceneTitle");var SoundEffect=function(t){function e(){var i=t.call(this)||this;return i.sound=null,e.I=i,i.startLoad(),i}return __extends(e,t),e.prototype.startLoad=function(){var t=new egret.Sound,e="resource/assets/kickm1.wav";t.addEventListener(egret.Event.COMPLETE,this.onLoadComplete,this),t.load(e)},e.prototype.onLoadComplete=function(t){this.sound=t.target},e.prototype.play=function(){this.sound.play(0,1)},e.I=null,e}(egret.DisplayObjectContainer);__reflect(SoundEffect.prototype,"SoundEffect");var SDK=!0,Main=function(t){function e(){var e=t.call(this)||this;return e.once(egret.Event.ADDED_TO_STAGE,e.addToStage,e),e}return __extends(e,t),e.prototype.addToStage=function(){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(t){switch(t.label){case 0:return Util.initial(this),GameObject.initial(this.stage),Camera2D.initial(),SDK?[4,Social.init()]:[3,2];case 1:t.sent(),t.label=2;case 2:return SceneTitle.loadScene(),egret.startTick(this.tickLoop,this),[2]}})})},e.prototype.tickLoop=function(t){return GameObject.process(),Camera2D.process(),!1},e}(eui.UILayer);__reflect(Main.prototype,"Main");var tileBigScale=2,TileBig=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.hp=7,n.sizeW*=tileBigScale,n.sizeH*=tileBigScale,n.display.scaleX=n.display.scaleY=tileBigScale,n}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;Tile.tiles=Tile.tiles.filter(function(e){return e!=t})},e.prototype.update=function(){if(!GameOver.I){if(this.display.rotation*=.75,this.checkTouch()){if(--this.hp<=0)return void this.defeated();Score.I.addPoint(2),SoundEffect.I.play(),Game.I.speed=0,this.display.rotation=randI(-5,5);for(var t=0;4>t;t++)new Debris(Game.I.tapX,Game.I.tapY)}this.Y+=Game.I.speed,this.checkFall()&&new GameOver}},e}(Tile);__reflect(TileBig.prototype,"TileBig");var TileLongLength=3,TileLong=function(t){function e(e,i){var n=t.call(this,e,i)||this;return n.length=TileLongLength,n.Y+=.5*n.sizeH,n.sizeH*=n.length,n.Y-=.5*n.sizeH,n.display.scaleX=.8,n.display.scaleY=n.length,n}return __extends(e,t),e.prototype.onDestroy=function(){var t=this;Tile.tiles=Tile.tiles.filter(function(e){return e!=t})},e.prototype.update=function(){if(!GameOver.I){if(this.display.anchorOffsetX*=.5,this.display.anchorOffsetY*=.5,this.checkTouching()){if(this.sizeH-=Game.I.speed,this.display.scaleY-=Game.I.speed/Util.h(TilePerH),this.Y-=Game.I.speed/2,this.sizeH<=Util.h(1.5*TilePerH))return void this.defeated();Game.I.counter%3==0&&(Score.I.addPoint(1),SoundEffect.I.play(),this.display.anchorOffsetX=randF(-6,6),this.display.anchorOffsetY=randF(-5,5)),new Debris(this.X+randF(.5*-this.sizeW,.5*this.sizeW),this.Y+.5*this.sizeH)}this.Y+=Game.I.speed,this.checkFall()&&new GameOver}},e.prototype.checkTouching=function(){return Game.I.touch&&Math.pow(Game.I.tapX-this.X,2)<Math.pow(.6*this.sizeW,2)&&Math.pow(Game.I.tapY-this.Y,2)<Math.pow(.6*this.sizeH,2)?!0:void 0},e}(Tile);__reflect(TileLong.prototype,"TileLong");var Button=function(t){function e(e,i,n,r,o,a,s,l,c,h,u){var p=t.call(this)||this;p.text=null,p.onTap=null,p.press=!1,p.touch=!1,p.x=0,p.y=0;var d=new egret.Shape;GameObject.baseDisplay.addChild(d),h?d.graphics.lineStyle(2,n):d.graphics.lineStyle(0),d.graphics.beginFill(l,c);var f=a*Util.width,y=s*Util.height;return d.graphics.drawRoundRect(-.5*f,-.5*y,f,y,.4*y),d.graphics.endFill(),d.touchEnabled=!0,d.x=r*Util.width,d.y=o*Util.height,p.display=d,e&&(p.text=Util.newTextField(e,i,n,r,o,!0,!1),GameObject.baseDisplay.addChild(p.text)),p.onTap=u,p.onTap&&p.display.addEventListener(egret.TouchEvent.TOUCH_TAP,p.onTap,p),p.display.addEventListener(egret.TouchEvent.TOUCH_BEGIN,p.touchBegin,p),p.display.addEventListener(egret.TouchEvent.TOUCH_MOVE,p.touchMove,p),p.display.addEventListener(egret.TouchEvent.TOUCH_END,p.touchEnd,p),p}return __extends(e,t),e.prototype.onDestroy=function(){this.onTap&&this.display.removeEventListener(egret.TouchEvent.TOUCH_TAP,this.onTap,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_BEGIN,this.touchBegin,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_MOVE,this.touchMove,this),GameObject.baseDisplay.removeEventListener(egret.TouchEvent.TOUCH_END,this.touchEnd,this),this.text&&GameObject.baseDisplay.removeChild(this.text)},e.prototype.update=function(){var t=this.touch?1.1:1;this.display.scaleX=this.display.scaleY=this.display.scaleX+.25*(t-this.display.scaleX),this.press=!1},e.prototype.touchBegin=function(t){this.x=t.stageX,this.y=t.stageY,this.press=!0,this.touch=!0},e.prototype.touchMove=function(t){this.x=t.stageX,this.y=t.stageY,this.touch=!0},e.prototype.touchEnd=function(t){this.touch=!1},e}(GameObject);__reflect(Button.prototype,"Button");var Camera2D=function(){function t(){}return t.initial=function(){t.x=0,t.y=0,t.localX=0,t.localY=0,t.scale=1,t.rotation=0},t.process=function(){GameObject.gameDisplay.anchorOffsetX=t.x,GameObject.gameDisplay.anchorOffsetY=t.y,GameObject.gameDisplay.x=this.localX,GameObject.gameDisplay.y=this.localY,GameObject.gameDisplay.scaleX=GameObject.gameDisplay.scaleY=t.scale,GameObject.gameDisplay.rotation=t.rotation},t}();__reflect(Camera2D.prototype,"Camera2D");var DebrisPerW=.1,DebrisPerH=.1,DebrisColor=0,DebrisVPerW=.06,DebrisVR=20,Debris=function(t){function e(e,i){var n=t.call(this)||this,r=Util.w(DebrisVPerW);return n.vx=randF(-r,+r),n.vy=randF(-r,+r),n.vr=randF(-DebrisVR,DebrisVR),n.setShape(e,i),n}return __extends(e,t),e.prototype.onDestroy=function(){},e.prototype.setShape=function(t,e){this.display=new egret.Shape,GameObject.gameDisplay.addChild(this.display);var i=this.display;i.x=t,i.y=e,i.graphics.beginFill(TileColor);var n=Util.w(randF(DebrisPerW/4,DebrisPerW)),r=Util.h(randF(DebrisPerH/4,DebrisPerH));i.graphics.drawRect(-.5*n,-.5*r,n,r),i.graphics.endFill()},e.prototype.update=function(){this.vy+=Util.h(.001),this.X+=this.vx,this.Y+=this.vy,this.display.rotation+=this.vr,this.Y>Util.height&&this.destroy()},e}(GameObject);__reflect(Debris.prototype,"Debris");var InputField=function(t){function e(e,i,n,r,o,a,s,l,c,h){var u=t.call(this)||this;u.text=null,u.onChange=null;var p=new egret.Shape;GameObject.baseDisplay.addChild(p),p.graphics.beginFill(l,c);var d=a*Util.width,f=s*Util.height;return p.graphics.drawRoundRect(-.5*d,-.5*f,d,f,.4*f),p.graphics.endFill(),p.touchEnabled=!0,p.x=r*Util.width,p.y=o*Util.height,u.display=p,u.text=new egret.TextField,u.text.type=egret.TextFieldType.INPUT,u.text.maxChars=e,u.text.size=i,u.text.textColor=n,u.text.width=d,u.text.height=f,u.text.x=Util.width*r-.5*u.text.width+.5*i,u.text.y=Util.height*o-.5*i,GameObject.baseDisplay.addChild(u.text),u.onChange=h,u.onChange&&u.text.addEventListener(egret.Event.CHANGE,function(){return u.onChange(u.text.text)},u),u}return __extends(e,t),e.prototype.onDestroy=function(){GameObject.baseDisplay.removeChild(this.text)},e.prototype.update=function(){},e}(GameObject);__reflect(InputField.prototype,"InputField");var Random=function(){function t(e){void 0===e&&(e=Math.floor(Math.random()*t.max)),this.x=123456789,this.y=362436069,this.z=521288629,this.w=e}return t.prototype["int"]=function(){return this.next()&t.max},t.prototype.f01=function(){return this["int"]()/(t.max+1)},t.prototype.f=function(t,e){return t+this.f01()*(e-t)},t.prototype.i=function(t,e){return Math.floor(this.f(t,e))},t.prototype.bool=function(t){return void 0===t&&(t=.5),this.f01()<t},t.prototype.next=function(){var t;return t=this.x^this.x<<11,this.x=this.y,this.y=this.z,this.z=this.w,this.w=this.w^this.w>>>19^(t^t>>>8)},t.max=1073741823,t}();__reflect(Random.prototype,"Random");var globalRandom=new Random,Rect=function(t){function e(e,i,n,r,o,a,s){void 0===a&&(a=!1),void 0===s&&(s=!1);var l=t.call(this)||this,c=new egret.Shape;l.display=c;var h=a?GameObject.gameDisplay:GameObject.baseDisplay;return s?h.addChild(l.display):h.addChildAt(l.display,1),c.graphics.beginFill(o,1),c.graphics.drawRect(e,i,n,r),c.graphics.endFill(),l}return __extends(e,t),e.prototype.update=function(){},e}(GameObject);__reflect(Rect.prototype,"Rect");var Sdk=function(){function t(){}return t.loadSdk=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i;return __generator(this,function(n){switch(n.label){case 0:return console.log("============================================================"),console.log("Liberapp.loadSdk:"),this.env=this.detectMode(location.origin),console.log("env: ",this.env),t=this.resolveSdkUrl(this.sdkPath),console.log("srcUrl: ",t),[4,this.loadScript(t)];case 1:return e=n.sent(),console.log("script:",e),i=window.LiberappSdk,"egret-wing"!==this.env?[3,3]:[4,i.enableDebug()];case 2:n.sent(),n.label=3;case 3:return console.log("liberappSdk:",i),[2,i]}})})},t.detectMode=function(t){return/^https:\/\/(.+)\.a\.liberapp\.net$/.test(t)?"production":/^https:\/\/(.+)\.a\.staging.\.liberapp\.net$/.test(t)?"staging":/^https:\/\/(.+)\.a\.development\.liberapp\.net$/.test(t)?"development":"egret-wing"},t.resolveSdkUrl=function(t){var e=this.baseUrls[this.env];return""+e+t},t.loadScript=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){return[2,new Promise(function(e,i){var n=document.createElement("script");n.async=!1,n.src=t,n.onload=function(){return e(n)},n.onerror=function(){return i(new Error("Can not load script: src:"+t))},document.head.append(n)})]})})},t.baseUrls={production:"https://liberapp.net",staging:"https://staging.liberapp.net",development:"https://localhost","egret-wing":"https://staging.liberapp.net"},t.sdkPath="/dist/sdk/liberapp-ja-0_9.js",t}();__reflect(Sdk.prototype,"Sdk");var Social=function(){function t(){}return t.init=function(){return __awaiter(this,void 0,void 0,function(){var t,e,i,n,r,o,a,s,l,c;return __generator(this,function(h){switch(h.label){case 0:return[4,Sdk.loadSdk()];case 1:return t=h.sent(),this.sdk=t,Toast.show({text:"ログイン中・・・",delay:3e4,canHide:!0}),[4,t.initializeAsync()];case 2:return h.sent(),[4,t.startGameAsync()];case 3:return h.sent(),Toast.show({text:this.playerName+"さんようこそ！",delay:3e4,canHide:!0}),e=this,[4,t.getLeaderboardAsync("default")];case 4:return e.leaderboard=h.sent(),[4,Promise.all([this.leaderboard.getEntryCountAsync(),this.leaderboard.getEntriesAsync(3,0),this.leaderboard.getPlayerEntryAsync(),this.sdk.player.getDataAsync(["level"])])];case 5:return i=h.sent(),n=i[0],r=i[1],o=i[2],a=i[3],this.playerEntry=o,this.rawData=a,this.hasBest?Toast.show({text:"今のところ"+n+"人中"+this.bestRank+"位です",delay:3e3}):(s=r[0],s&&(console.log(s),l=s.getPlayer().getName(),c=s.getScore(),Toast.show({text:n+"人が遊んでいます!\n一番は"+l+"さん\nスコアは"+c+"です",delay:3e3}))),[2]}})})},Object.defineProperty(t,"hasBest",{get:function(){return!!this.myBestEntry},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestScore",{get:function(){return this.hasBest?this.myBestEntry.getScore():0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"bestRank",{get:function(){return this.hasBest?this.myBestEntry.getRank():void 0},enumerable:!0,configurable:!0}),Object.defineProperty(t,"playerEntry",{set:function(e){console.log("myBest:",this.myBestEntry,e),this.myBestEntry=e,Score.bestScore=t.bestScore,Score.bestRank=t.bestRank},enumerable:!0,configurable:!0}),t.setScore=function(t){return __awaiter(this,void 0,void 0,function(){var e;return __generator(this,function(i){switch(i.label){case 0:return console.log("setScore "+t),Toast.show({text:"ハイスコアを送信中",delay:3e4,canHide:!0}),e=this,[4,this.leaderboard.setScoreAsync(t)];case 1:return e.playerEntry=i.sent(),Toast.show({text:"順位は"+this.bestRank+"位でした",delay:3e3}),[2]}})})},Object.defineProperty(t,"playerName",{get:function(){return this.sdk.player.getName()||"名無し"},enumerable:!0,configurable:!0}),Object.defineProperty(t,"hasData",{get:function(){return!!this.rawData},enumerable:!0,configurable:!0}),Object.defineProperty(t,"level",{get:function(){return this.hasData&&"level"in this.rawData?this.rawData.level:0},enumerable:!0,configurable:!0}),t.setLevel=function(t){return __awaiter(this,void 0,void 0,function(){return __generator(this,function(e){switch(e.label){case 0:return this.rawData.level=t,console.log("setLevel "+t+" "+this.rawData.level),Toast.show({text:"達成レベルを送信中",delay:3e4,canHide:!0}),[4,this.sdk.player.setDataAsync({level:t})];case 1:return e.sent(),Toast.show({text:"送信完了",delay:1500}),[2]}})})},t}();__reflect(Social.prototype,"Social");var Util=function(){function t(){}return t.w=function(e){return e*t.width},t.h=function(e){return e*t.height},t.initial=function(t){this.width=t.stage.stageWidth,this.height=t.stage.stageHeight},t["break"]=function(t,e){t&&console.log(e)},t.clamp=function(t,e,i){return e>t&&(t=e),t>i&&(t=i),t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(t,e,i){return t+(e-t)*i},t.deltaAngle=function(t){var e=(t+Math.PI)/(2*Math.PI);return e=65536*e&65535,e=e/65536*Math.PI*2-Math.PI},t.color=function(t,e,i){return 65536*Math.floor(255*t)+256*Math.floor(255*e)+Math.floor(255*i)},t.colorLerp=function(t,e,i){var n=1-i,r=((16711680&t)*n+(16711680&e)*i&16711680)+((65280&t)*n+(65280&e)*i&65280)+((255&t)*n+(255&e)*i&255);return r},t.newTextField=function(e,i,n,r,o,a,s){var l=new egret.TextField;return l.text=e,l.bold=a,l.size=i,l.textColor=n,s?(l.x=(t.width-l.width)*r,l.y=(t.height-l.height)*o):(l.x=t.width*r-.5*l.width,l.y=t.height*o-.5*l.height),l},t.newShadowText=function(t,e,i){void 0===i&&(i=1.5);var n=new egret.TextField;return n.text=t.text,n.bold=t.bold,n.size=t.size,n.textColor=e,n.x=t.x+i,n.y=t.y+i,n.alpha=.5,n},t.newBitmap=function(t,e,i,n){var r=new egret.Bitmap;return r.texture=RES.getRes(t),GameObject.baseDisplay.addChild(r),r.x=e,r.y=i,r.anchorOffsetX=.5*r.width,r.anchorOffsetY=.5*r.height,r.scaleX=r.scaleY=n,r},t.getSaveDataNumber=function(t,e){var i=egret.localStorage.getItem(t),n=e;return null!=i&&(n=parseInt(i)),n},t.setSaveDataNumber=function(t,e){egret.localStorage.setItem(t,""+e)},t.getSaveDataString=function(t,e){var i=egret.localStorage.getItem(t);return null==i&&(i=e),i},t.setSaveDataString=function(t,e){egret.localStorage.setItem(t,e)},t}();__reflect(Util.prototype,"Util");var GameOver=function(t){function e(){var i=t.call(this)||this;return i.texts=[],i.retryButton=null,i.step=0,i.newRecord=!1,i.fadeInFrame=64,e.I=i,Game.I.speed=0,i.texts[0]=Util.newTextField("SCORE : "+Score.I.point.toFixed(),Util.width/12,FONT2_COLOR,.5,.3,!0,!1),egret.Tween.get(i.texts[0],{loop:!1}).to({alpha:0},0).to({alpha:1},1e3),GameObject.baseDisplay.addChild(i.texts[0]),SDK&&Score.I.point>Score.bestScore&&(Social.setScore(Score.I.point),i.newRecord=!0,Score.bestScore=Score.I.point),i}return __extends(e,t),e.prototype.onDestroy=function(){this.texts.forEach(function(t){GameObject.baseDisplay.removeChild(t)}),this.texts=null,e.I=null},e.prototype.update=function(){this.step++,this.step==this.fadeInFrame&&(this.retryButton=new Button("リトライ",Util.width/16,BACK_COLOR,.5,.65,.4,.1,FONT2_COLOR,1,!1,this.onTapRetry),this.newRecord&&(this.texts[1]=Util.newTextField("NEW RECORD!",Util.width/13,FONT2_COLOR,.5,.4,!0,!1),egret.Tween.get(this.texts[1],{loop:!0}).to({alpha:0},500).to({alpha:1},500),GameObject.baseDisplay.addChild(this.texts[1])))},e.prototype.onTapRetry=function(){GameObject.transit=ScenePlay.loadScene},e.I=null,e}(GameObject);__reflect(GameOver.prototype,"GameOver");var Score=function(t){function e(){var i=t.call(this)||this;return i.point=0,i.text=null,e.I=i,i.point=0,i.text=Util.newTextField("",Util.width/22,FONT2_COLOR,0,0,!0,!0),GameObject.baseDisplay.addChild(i.text),i}return __extends(e,t),e.prototype.onDestroy=function(){this.text.parent.removeChild(this.text),this.text=null,e.I=null},e.prototype.update=function(){},e.prototype.addPoint=function(t){void 0===t&&(t=1),this.setPoint(this.point+t)},e.prototype.setPoint=function(t){var e=this.point.toFixed(),i=t.toFixed();this.point=t,e!=i&&(this.text.text=""+i)},e.I=null,e.bestScore=0,e.bestRank=0,e}(GameObject);__reflect(Score.prototype,"Score");var DefaultToastOptions={text:"",delay:3e3,canHide:!1},Toast=function(t){function e(e){var i=t.call(this)||this;return i.queue=[],i.rect=new eui.Rect,i.rect.alpha=0,i.label=new eui.Label,i.label.maxWidth=e,i.rect.addEventListener(eui.UIEvent.CREATION_COMPLETE,i.onRectCreationComplete,i),i.label.addEventListener(eui.UIEvent.RESIZE,i.onLabelResized,i),GameObject.baseDisplay.addChild(i.rect),i}return __extends(e,t),e.prototype.update=function(){},e.show=function(t){var i=__assign({},DefaultToastOptions,t);this.I||(this.I=new e(.6*Util.width)),this.I.show(i)},e.prototype.onDestroy=function(){var t=e.I;e.I=void 0,t&&(t.rect.parent.removeChild(t.rect),t.rect.removeChildren(),t.rect=void 0,t.label=void 0)},e.prototype.show=function(t){if(console.log("Toast.show"),this.currentOptions){if(!this.currentOptions.canHide)return void this.queue.push(t);this.currentTween.setPaused(!0),this.currentTween=void 0,this.currentOptions=void 0,this.queue=[]}this.currentOptions=t,this.toastText=t.text,this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:1},300).wait(t.delay).call(this.onStartHide,this)},e.prototype.onStartHide=function(){console.log("Toast.onStartHide"),void 0!==this.currentTween&&(this.currentTween=egret.Tween.get(this.rect),this.currentTween.to({alpha:0},300).call(this.onCompleteHide,this))},e.prototype.onCompleteHide=function(){if(console.log("Toast.onCompleteHide"),this.currentTween=void 0,this.currentOptions=void 0,0===this.queue.length)return void this.destroy();var t=this.queue.shift();this.show(t)},e.prototype.onRectCreationComplete=function(){console.log("Toast.onRectCreationComplete"),this.rect.fillColor=0,this.rect.fillAlpha=.6,this.rect.horizontalCenter=0,this.rect.verticalCenter=0,this.rect.ellipseWidth=30,this.rect.ellipseHeight=30,this.label.x=20,this.label.y=20,this.label.size=28,this.rect.addChild(this.label),this.toastText=""},Object.defineProperty(e.prototype,"toastText",{set:function(t){console.log("Toast.toastText:"),this.label.text=t},enumerable:!0,configurable:!0}),e.prototype.onLabelResized=function(){console.log("Toast.onLabelResized:"),this.rect.width=this.label.width+40,this.rect.height=this.label.height+40,this.rect.x=(Util.width-this.rect.width)/2,this.rect.y=(Util.height-this.rect.height)/2},e}(GameObject);__reflect(Toast.prototype,"Toast");